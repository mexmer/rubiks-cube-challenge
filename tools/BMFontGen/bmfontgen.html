<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<title>Creating Bitmap Fonts using bmfontgen</title>
</head>
<body>

<h2>Creating Bitmap Fonts using bmfontgen</h2>

<P>Author: Gary Kacmarcik (garykac@microsoft.com)<BR>Revision:&nbsp;30 August 2006 </P>
<H3>Introduction</H3>
<P>The bmfontgen application is a command line utility which can convert a TrueType or OpenType font into a bitmap font. A bitmap font consists of one or more images plus an XML descriptor file which identifies the location of each glyph in the bitmap images along with additional font metric data. These bitmap fonts can be useful in game development where one cannot assume that the game platform provides a font renderer. </P>
<P>This document describes how to create bitmap fonts and how to use them in the XNA
programming environment.
</P>
<H3>Features</H3>
<P>There are a number of bitmap font creation applications available. The bmfontgen application differs from most in that it: </P>
<UL>
<LI>Supports Unicode 
<LI>Supports extracting more than 256 characters 
<LI>Allows the set of included characters to be specified as ranges or from a file 
<LI>Permits individual glyphs to be replaced with custom images</LI></UL>
<H3>Limitations</H3>
<P>While bmfontgen strives to provide full Unicode character support, it is worth noting the following limitations: </P>
<UL>
<LI>While special glyphs like ligatures, non-spacing marks and contextual forms will be extracted as part of the font, currently no special support is provided for these characters. 
<LI>Surrogate characters are not supported.</LI></UL>
<P>Other limitations include: </P>
<UL>
<LI>No codepages other than Unicode are supported 
<LI>Glyphs are not packed as tightly as possible in the image bitmap 
<LI>Italic fonts may have the top or bottom tails clipped</LI></UL>
<P>Some of these limitations may be removed in later versions. </P>
<H2>I : Basic Operation</H2>
<H3>Using bmfontgen to create fonts</H3>
<P>The most basic operation of bmfontgen requires that you specify a font and an output file name. </P><PRE>   bmfontgen -name "Courier New" -size 12 -output "courier"
</PRE>
<P>This command will create a bitmap font with the default set of characters. The font will be based on 12 point "Courier New" and be saved it in "courier.xml" and "courier-0.png". </P>
<P>Alternately, you can use the Windows interface to choose a font using the -fontdialog option: </P><PRE>   bmfontgen -fontdialog -output "font"
</PRE>
<P>This will bring up the standard Windows font selection dialog and allow you to select the font interactively.</P>
<H3>Using bitmap fonts created by bmfontgen in XNA</H3>
<P>To load and render bitmap fonts created with bmfontgen, you'll want to make use of the BitmapFont class. This rest of this section contains sample code that makes use of the BitmapFont class to display a single text string in a window. </P>
<P>The basic procedure is:</P>
<UL>
<LI>Include a using reference to XNAExtras</LI>
<LI>Add <EM>bitmapfont.cs</EM> to your project</LI>
<LI>Create the font by instantiating BitmapFont and passing it the XML font descriptor file generated by bmfontgen</LI>
<LI>Render text in your drawing code using the BitmapFont::DrawString method.</LI>
<LI>Reset the font whenever the device changes (using BitmapFont::Reset)</LI></UL>
<P>Here is the sample code for a&nbsp;simple application that displays a string. Most of the code is from the XNA template - the font-related code is highlighted in <FONT color=#008000>green</FONT>.</P><PRE><FONT color=#0000ff>using System;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;
<FONT color=#008000>using XNAExtras;
</FONT>
namespace SimpleFontTest
{
    class SimpleFontTest : Microsoft.Xna.Framework.Game
    {
<FONT color=#008000>        private BitmapFont m_font;</FONT>
        private Microsoft.Xna.Framework.Components.GraphicsComponent m_graphics;

        public SimpleFontTest()
        {
            m_graphics = new Microsoft.Xna.Framework.Components.GraphicsComponent();
            this.GameComponents.Add(m_graphics);
        }

        protected override void OnStarting()
        {
            base.OnStarting();
            m_graphics.GraphicsDevice.DeviceReset += new EventHandler(GraphicsDevice_DeviceReset);

<FONT color=#008000>            // create the font
            m_font = new BitmapFont("font.xml");
</FONT>
            LoadResources();
        }

        void GraphicsDevice_DeviceReset(object sender, EventArgs e)
        {
            LoadResources();
        }

        void LoadResources()
        {
<FONT color=#008000>            // reset the font when the GraphicsDevice changes
            m_font.Reset(m_graphics.GraphicsDevice);
</FONT>        }

        protected override void Draw()
        {
            // Make sure we have a valid device
            if (!m_graphics.EnsureDevice())
                return;

            m_graphics.GraphicsDevice.Clear(Color.CornflowerBlue);
            m_graphics.GraphicsDevice.BeginScene();

<FONT color=#008000>            // draw the string
            m_font.DrawString(20, 20, Color.DarkBlue, "Sample string");
</FONT>
            m_graphics.GraphicsDevice.EndScene();
            m_graphics.GraphicsDevice.Present();
        }
    }
}
</FONT></PRE>
<P>A number of overloads for DrawString are provided that allow parameters like the (x,y) position and color to be omitted. When these parameters are not present, the text color and position is determined by the previous DrawString call. </P>
<P>Note that the BitmapFont class currently provides only basic text rendering capabilities. It does not justify text or provide word wrap capabilities. It also does not support most advanced text rendering options, like bidirectional (or even right-to-left) text, complex ligatures, non-spacing marks and contextual forms. </P>
<H2>II : Advanced Options</H2>
<H3>Choosing an appropriate text rendering hint</H3>
<P>While not required, choosing an appropriate text rendering hint value when creating the font can improve the appearance of the bitmap font, especially at small point sizes. </P>
<P>The TextRenderingHint is specified via the -trh option. There are five possible hint values that can be used: </P>
<BLOCKQUOTE>aa : Anti-aliased<BR>aa-grid : Anti-aliased with grid fit<BR>ct-grid : ClearType with grid fit<BR>1bpp : One bit per pixel<BR>1bpp-grid : One bit per pixel with grid fit<BR></BLOCKQUOTE>
<P>For example, to set the hint to enable anti-aliasing, the following option would be used: </P><PRE>   -trh aa
</PRE>
<P>The difference between the various options is demonstrated in the following table, which shows Times New Roman 10pt using each of the text rendering hint options: </P>
<TABLE align=center>
<TBODY>
<TR>
<TD><IMG src="images/731952.png"></TD>
<TD><IMG src="images/731959.png"></TD>
<TD><IMG src="images/731960.png"></TD>
<TD><IMG src="images/731947.png"></TD>
<TD><IMG src="images/731951.png"></TD></TR>
<TR>
<TD align=middle>aa</TD>
<TD align=middle>aa-grid</TD>
<TD align=middle>ct-grid</TD>
<TD align=middle>1bpp</TD>
<TD align=middle>1bpp-grid</TD></TR></TBODY></TABLE>
<P>Note that at smaller point sizes, the aa hint can result in a text that is not as bright as that produced with one of the gridfit hints. The point at which this happens varies from font to font, but seems common at font sizes less than 12 pts. The following table shows Times New Roman at different point sizes rendered using the aa hint: </P>
<TABLE align=center>
<TBODY>
<TR>
<TD><IMG src="images/731939.png"></TD>
<TD><IMG src="images/731952.png"></TD>
<TD><IMG src="images/731961.png"></TD>
<TD><IMG src="images/731962.png"></TD>
<TD><IMG src="images/732442.png"></TD></TR>
<TR>
<TD align=middle>Times 8pt</TD>
<TD align=middle>Times 10pt</TD>
<TD align=middle>Times 12pt</TD>
<TD align=middle>Times 14pt</TD>
<TD align=middle>Times 16pt</TD></TR></TBODY></TABLE>
<P>To help avoid these rendering problems, bmfontgen uses the following defaults: aa-grid for point sizes less than 12; and aa for point sizes 12 and larger. Users are strongly encouraged to evaluate the different TextRenderingHints when creating fonts that are 12 points or less in size. </P>
<H3>Using an options file</H3>
<P>Option files are text files that contain all of the options needed to create a single font. They are useful when the number of options being specified on the command line becomes large, or when certain extended options are required. </P>
<P>A simple option file is: </P><PRE>   -name "Courier New"
   -size 12
   -output courier12
</PRE>
<P>Note that there is one option per line in an option file. To use an options file to create a font, use the -optfile option with the name of the options file. </P><PRE>   bmfontgen -optfile font_options.txt
</PRE>
<P>The following rules apply to options in an option file: </P>
<BLOCKQUOTE>No line may be longer than 128 characters<BR>Each option line must begin with a hyphen ('-')<BR>Lines that do not begin with a hyphen are treated as comments and are ignored.<BR>Comments may not appear on the same line as an option<BR></BLOCKQUOTE>
<P>Any option that can be used on the command line can also be specified in an options file. There is also an additional set of options (called "extended options" - see the next section for more information) that are only valid when used within an options file. In addition, some options (like -range and -source) are permitted multiple times in an options file, whereas they are only allowed once on the command line. </P>
<H3>Extended options</H3>
<P>While most options can be specified directly on the command line, there is a small set of options that can only be specified in an options file. These options are known as extended options. These options are considered to be more complex than the other options because of the number of parameters that they require and it is this complexity that restricts them to the options file. </P>
<P>Currently, the only extended option is -custom. </P>
<P>Information on each extended option can be found in Appendix A. </P>
<H3>Adding custom glyphs to a font</H3>
<P>It is often desirable to add a few special characters to a font, so that these symbols can be written out in a string of text. Custom characters can be added (or used to replace existing characters) by using the -custom extended option. </P>
<P>As an example, to replace the letter 'q' in a font with a custom image, simply add the following extended option to your options file (custom glyphs can only be specified in an options files): </P><PRE>   -custom 0071 abxy.png 0 0 20 20 16 21 0
</PRE>
<P>This will replace Unicode codepoint 0071 ('q') with the portion of the "abxy.png" bitmap defined by the (0,0, 20,20) rectangle. The final three options are the baseline (measured from the top of the bitmap rectangle), advance width and the left side bearing. These last options are used to position the glyph relative to the other characters and to specify the spacing around the glyph, as shown in the following figure. </P>
<TABLE cellSpacing=5 cellPadding=5 align=center>
<TBODY>
<TR>
<TD vAlign=center align=middle><IMG src="images/732438.png"></TD>
<TD align=middle><IMG src="images/731927.png"></TD></TR>
<TR>
<TD align=middle>"abxy.png"</TD>
<TD align=middle>Custom glyph extracted from "abxy.png"<BR>with metrics</TD></TR></TBODY></TABLE>
<P>When this option is used with a 14 point "Comic Sans MS" font, the following bitmap font is created. </P>
<TABLE align=center>
<TBODY>
<TR>
<TD align=middle><IMG src="images/731929.png"></TD></TR>
<TR>
<TD align=middle>Font bitmap with the 'q' character<BR>replaced by a custom glyph </TD></TR></TBODY></TABLE>
<P>Once the font has been created in this manner, the custom glyph will be displayed instead of the original character. In this example, drawing the string "Press the q button to switch weapons" would display as follows: </P>
<TABLE align=center>
<TBODY>
<TR>
<TD align=middle><IMG src="images/731932.png"></TD></TR></TBODY></TABLE>
<P>When used in a real game, a character other then ‘q’ would likely be chosen. Any valid Unicode character can be replaced in this fashion. </P>
<H3>Creating fonts with international characters</H3>
<P>By default, the font will contain the standard A-Z upper and lower case plus the standard punctuation marks (all Unicode code points from 0020 to 007E). While this range is appropriate for English and a few other languages, there are many languages which require additional characters. </P>
<P>To change the range of characters that are included in the generated font, you can use the -range option. A single range can be specified directly on the command line: </P><PRE>   -range 0000-00ff
</PRE>
<P>or multiple ranges can be specified in an options file: </P><PRE>   -range 0020-007e
   -range 00a0-00ff
   -range 0152-0153
</PRE>
<P>Range values must be specified as 4 hex digits and must be connect by a single hyphen. No spaces are allowed in the range specification. </P>
<P>If you specify a range value, then the default range (0020-007E) will not be used. Thus, if you want basic Latin character support (including punctuation marks), you need to add characters from this range into your range specifications. </P>
<P>Here is a sample options file that creates a Russian font from “Lucida Sans Unicode” </P><PRE>   -name "Lucida Sans Unicode"
   -size 14
   -output russian
   -range 0020-007e
   -range 0400-04ff
</PRE>
<P>Drawing the string "Спасибо Вам за то, что Вы спасли мне жизнь!" with this font produces: </P>
<TABLE align=center>
<TBODY>
<TR>
<TD align=middle><IMG src="images/731938.png"></TD></TR></TBODY></TABLE>
<H3>Creating CJK fonts</H3>
<P>Chinese, Japanese and Korean fonts are somewhat more challenging to generate because of the large number of glyphs present in those fonts. There can be 10’s of thousands of characters in a single CJK font, most of which will not be used. While this problem can be partially addressed using the -range option, that approach is unwieldy and potentially problematic since there is no guarantee that the defined ranges contain all of the required characters. </P>
<P>To address this problem, bmfontgen permits a character-source file to be defined that contains the set of all characters that needs to be included in the font. Characters do not need to occur uniquely in this file – a character may occur multiple times in this file and it will be defined only once in the created font. This allows a dialog script or even source code to be used as a character-source file. The only restriction is that the file must be UTF-8 encoded (with/without a BOM char). </P>
<P>Character-source file are specified with the -source option. A single character-source file can be specified directly on the command line: </P><PRE>   -source game_dialog.txt
</PRE>
<P>or multiple character-source files can be specified in an options file: </P><PRE>   -source dialog.cs
   -source messages.cs
   -source about.cs
</PRE>
<P>While this option was originally intended to provide support for CJK fonts, it can be used when creating fonts for any language. The -source option can be used as a safeguard to ensure that all required characters are present. </P>
<P>Here is a sample options file that creates a Japanese font from "ＭＳ Ｐゴシック", including a standard set of Latin and Japanese characters plus all characters from the "japanese.txt" file. </P><PRE>   -name "ＭＳ Ｐゴシック"
   -size 14
   -output japanese
   -bmsize 256
   -range 0020-007e
   -range 3000-3100
   -source japanese.txt
</PRE>
<P>Using this font to display the string "お兄ちゃ…　お兄ちゃんなんか大っ嫌い！" produces this output: </P>
<TABLE align=center>
<TBODY>
<TR>
<TD align=middle><IMG src="images/731936.png"></TD></TR></TBODY></TABLE>
<H2><BR>Appendix A<BR>Summary of available options</H2>
<P>This section provides a brief description of each option available in bmfontgen. Unless otherwise specified, these options may be specified on the command line and may only occur once. Extended options (that can only be specified in an options file) and options that are permitted more than once (but only in an options file), are noted in the description. </P>
<H3>-blackbg</H3>
<P>Normally the font image bitmap is created with a transparent background and white text. This can make it difficult to review the font to evaluate how well the glyphs are formed since most image display programs show the image on a white background. This option will force the bitmap to be created with a black background so that the characters show up clearly. </P>
<P>Note that this option should not be used when creating the final font bitmap. </P>
<H3>-bmsize <I>size</I></H3>
<P>By default, the font bitmap size is 256x256. This option allows the user to change the size of each bitmap to any value from 64 to 1024. The size value is used to set both the height and the width of the font bitmap. Sizes that are an integral power of 2 are recommended, but not required (a warning is issued when a non-power-of-2 value is used). </P>
<H3>-bold</H3>
<P>Create a bold version of the specified font. This option is ignored if the –fontdialog option is used. </P>
<P>Other font style options include -italic, -strikeout and -underline. </P>
<H3>-custom <I>ch file x y w h base aw lsb</I></H3>
<P>Define a custom glyph to replace the standard glyph (if any) in the font for the specified character. The character is automatically added to the list of characters included in the font (so a separate -range option is not necessary). </P>
<P>Note: This is an extended option and my only appear in an options file. </P>
<P>The arguments for this option are: </P>
<BLOCKQUOTE>ch : the Unicode character, encoded as a 4 hex digit value<BR>file : the file that contains the custom glyph bitmap<BR>x, y : the origin of the glyph in the bitmap<BR>w, h : the width and height of the glyph in the bitmap<BR>base : the baseline of the glyph, measured from the origin of the glyph's bounding rectangle<BR>aw : the advance width – the horizontal distance to advance the pen after drawing this character<BR>lsb : the left side bearing – the horizontal distance from the pen starting position to the left side of the glyph bitmap<BR></BLOCKQUOTE>
<P>The -custom option may appear multiple times, but each option should describe a separate character. If multiple custom options appear for the same character, only the last one will be used. </P>
<H3>-fontdialog</H3>
<P>Use the OS’s font selection dialog to interactively select the font name, size and style. </P>
<P>This option can be used instead of the -name and -size/-pxsize options. If this option is used, the -bold, -italic, -strikeout and -underline options are ignored. </P>
<H3>-italic</H3>
<P>Create an italic version of the specified font. This option is ignored if the –fontdialog option is used. </P>
<P>Other font style options include -bold, -strikeout and -underline. </P>
<H3>-listfonts</H3>
<P>Produce a list of available fonts and print it to stdout. </P>
<P>Note that because of codepage issues, fonts that have localized names may not display correctly when written to the console. To avoid this problem, use –listfontsfile which will write the list of available fonts into a file. </P>
<H3>-listfontsfile <I>fontfilename</I></H3>
<P>Same as –listfonts, but the font list is written into a UTF-8 encoded text file instead of printed to stdout. This option is useful when there are installed fonts that have localized names since these names can be mangled when printed to the console. </P>
<H3>-name <I>fontname</I></H3>
<P>The name of the font to create. </P>
<P>This option, along with the -size/-pxsize option, is required unless the –fontdialog option is used. </P>
<H3>-nowarn-all</H3>
<P>Don’t issue any warnings. </P>
<H3>-nowarn-missingglyph</H3>
<P>Don’t issue a warning if a glyph in the requested range is missing from the font. </P>
<H3>-optfile <I>filename</I></H3>
<P>Read the options from the specified file instead of from the command line. Note that some options (“extended options”) can only be specified in an options file. See “Using an options file” in Section II for more information. </P>
<H3>-output <I>base-output-name</I></H3>
<P>The base filename for the output files. The base filename is restricted to no more than 50 characters in length. </P>
<P>For basic fonts, the extension “.png” and “.xml” will be added to the font image and font xml description files, respectively. If more than one image is required to encode the font, a numeric value will be added to the base filename. </P>
<P>This is a required option. </P>
<H3>-range <I>start</I>-<I>end</I></H3>
<P>Specify a start and end character range to include in the font. By default the range is 0020 to 007E. The start and end character values must be Unicode code points and must be encoded as 4 hex digit values. </P>
<P>If you specify a range, then the default range (0020-007E) will not be used. If you want to include basic latin support, then you need to include this range in your range specification. </P>
<P>Note that the -range option may only be specified once on the command line. </P>
<P>To define multiple disjoint character ranges for a font, use this option in an options file. The -range option may be specified multiple times in an option file and the union of all defined ranges will be used for the font. See “Using an options file” in Section II for more information about using option files. </P>
<H3>-size <I>size</I></H3>
<P>Specify the size of the font in points. Only font sizes from 7 to 50 points are supported. This option may not be used in conjunction with the –pxsize option. </P>
<H3>-source <I>filename</I></H3>
<P>Specify a character-source file that contains the set of characters that should be included in the font. The file must be UTF-8 encoded (note that 7-bit ASCII encoded files are valid UTF-8 files); the 3-byte UTF-8 BOM character is not required and is ignored if present. </P>
<P>When this option is used, the default character range (0020-007E) will be ignored. If this option is used in conjunction with the -range option, the font will contain the union of all characters specified by the two options. </P>
<P>Note that the -source option may only be specified once on the command line. </P>
<P>To define multiple character-source files, use this option in an options file. The -source option may be specified multiple times in an option file and the union of all characters will be used for the font. See “Using an options file” in Section II for more information about using option files. </P>
<H3>-strikeout</H3>
<P>Create a strikeout version of the specified font. This option is ignored if the –fontdialog option is used. </P>
<P>Other font style options include -bold, -italic and -underline. </P>
<H3>-trh <I>hint</I></H3>
<P>Set the TextRenderingHint, which can help the GDI+ text rendering engine produce better font bitmaps. The hint value can be any of: </P>
<BLOCKQUOTE>1bpp : Use one bit per pixel<BR>1bpp-grid : Use one bit per pixel and fit the glyphs to a display grid<BR>aa : Enable anti-aliasing<BR>aa-grid : Enable anti-aliasing and fit the glyphs to a display grid<BR>ct-grid : Use ClearType rendering and fit the glyphs to a display grid<BR></BLOCKQUOTE>
<H3>-underline</H3>
<P>Create an underlined version of the specified font. This option is ignored if the –fontdialog option is used. </P>
<P>Other font style options include -bold, -italic and -strikeout. </P>
<H3>-v</H3>
<P>Verbose output - display lots of extraneous information while the font is being created. </P>

</body>
</html>
